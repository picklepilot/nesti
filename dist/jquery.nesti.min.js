/*
 *  nesti - v0.0.1
 *  A straight forward plugin for adding some very helpful functionalities to nested/tree structure checkbox lists.
 *  http://jkaczmar.com
 *
 *  Made by Justin Kaczmar
 *  Under MIT License
 */

!function(t,e,i,n){"use strict";var s="nesti",l={filterable:!1,filter:{css:{position:"sticky",top:0,width:"100%",padding:"6px 10px",border:"none",boxSizing:"border-box"}},listItem:{css:{display:"flex",alignItems:"center"}},collapse:{enabled:!1,speed:250,collapseTemplate:'<i class="fas fa-minus-circle text-smaller position-relative nesti-toggle nesti-toggle-collapse" style="font-size: .6rem;"></i>',expandTemplate:'<i class="fas fa-plus-circle text-smaller position-relative nesti-toggle nesti-toggle-expand" style="font-size: .6rem;"></i>'},onChange:null};function a(e,i){this.element=e,this.settings=t.extend(!0,{},l,i),this._defaults=l,this._name=s,this._targetId=this.element.id,this._html=[],this.init(),this.api={"api.collect":function(){return Array.from(this.tree.find("input.leaf:checkbox:checked").map(function(){return this.dataset.value}))},"api.filter":function(t){this.filter(t)},"api.buildList":function(t,e=!1){this.buildList(t,e)}}}t.extend(a.prototype,{init:function(){this.settings.filterable&&this._makeFilter(),this.tree=t(this.element),this._dressElement(),this.initHandlers()},_dressElement:function(){this.tree.css("list-style","none"),this.tree.find("ul").css("list-style","none")},initHandlers:function(){var e=this;t(e.element).find("input:checkbox").on("change",function(){var i=t(this).closest("li");e._isRoot(i)?e._lookForward(i):e._isLeaf(i)?e._lookBackward(i):(e._lookForward(i),e._lookBackward(i)),"function"==typeof e.settings.onChange&&e.settings.onChange.call()}),e._initToggleHandlers()},_initToggleHandlers:function(){var e=this;t(e.element).find(".nesti-toggle-collapse").on("click",function(){var i=t(this).closest("li");e.collapse(i)}),t(e.element).find(".nesti-toggle-expand").on("click",function(){var i=t(this).closest("li");e.expand(i)})},_makeFilter:function(){var e=this;t('<input type="text" class="form-control form-control-sm" placeholder="Find a filter.." id="'+this._targetId+'-filter-input">').css(e.settings.filter.css).insertBefore(this.element),t("#"+this._targetId+"-filter-input").on("keyup",function(){e.filter(t(this).val())})},_lookForward:function(e){var i=!!e.find("input:checkbox").first().prop("indeterminate")||e.find("input:checkbox").first().prop("checked");e.find("li").each(function(e,n){t(n).find("input:checkbox").prop("checked",i)})},_lookBackward:function(e){var i=this;e.parents("li").each(function(e,n){if(i._allChildrenChecked(t(n))?(t(n).find("input:checkbox").first().prop("checked",!0),t(n).find("input:checkbox").first().prop("indeterminate",!1)):i._someChildrenChecked(t(n))?t(n).find("input:checkbox").first().prop("indeterminate",!0):(t(n).find("input:checkbox").first().prop("checked",!1),t(n).find("input:checkbox").first().prop("indeterminate",!1)),"list"===t(n).parent().attr("id"))return!1})},_allChildrenChecked:function(t){return t.find("li").find("input:checkbox:checked").length===t.find("li").find("input:checkbox").length},_someChildrenChecked:function(t){var e=t.find("li").find("input:checkbox:checked").length;return e>0&&e!==t.find("li").find("input:checkbox").length},_isLeaf:function(t){return t.find("li").length<1},_isRoot:function(t){return t.parent("#list").length},filter:function(e){var i=this.tree.find("li");t(i).each(function(){var i=t(this).find("label").text();""===e?(t(this).css("visibility","visible"),t(this).fadeIn()):i.search(new RegExp(e,"i"))<0?(t(this).css("visibility","hidden"),t(this).fadeOut()):(t(this).css("visibility","visible"),t(this).fadeIn())})},collapse:function(t){t.find("ul").first().slideUp(this.settings.collapse.speed),t.find(".fa-minus-circle").first().replaceWith(this.settings.collapse.expandTemplate),this._initToggleHandlers()},expand:function(t){t.find("ul").first().slideDown(this.settings.collapse.speed),t.find(".fa-plus-circle").first().replaceWith(this.settings.collapse.collapseTemplate),this._initToggleHandlers()},buildList:function(e,n=!1){this._makeTier(e,n);var s=t(this._html.join(""));s.first("ul").attr("id",this.element.id),s.find(".list-item-template").css(this.settings.listItem.css),i.getElementById(this.element.id).innerHTML=s.html(),this._dressElement(),this.initHandlers()},_makeTier:function(t,e){this._html.push('<ul style="padding-left: 18px;">'),t.forEach((t,i)=>{this._html.push("<li>"),this._html.push(this._listItemTemplate(t,i,e)),t.items&&this._makeTier(t.items,e),this._html.push("</li>")}),this._html.push("</ul>")},_listItemTemplate(t,e,i){return'<div class="list-item-template">'+(t.items&&this.settings.collapse.enabled?this.settings.collapse.collapseTemplate:"")+'<input class="'+(t.items?"":"leaf")+'" id="'+this._slugify(t.label)+"-"+e+'" data-value="'+(i?t.label:t.value)+'" data-id="'+this._slugify(t.label)+"-"+e+'" type="checkbox" style="margin:4px;margin-left:8px;" '+(t.checked?"checked":"")+' /><label class="leaf-label" for="'+this._slugify(t.label)+"-"+e+'" style="margin-bottom:0;">'+t.label+"</label></div>"},_slugify:t=>t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}),t.fn[s]=function(e){var i,n=arguments;return void 0===e||"object"==typeof e?this.each(function(){t.data(this,"plugin_"+s)||t.data(this,"plugin_"+s,new a(this,e))}):"string"==typeof e&&"_"!==e[0]&&"init"!==e?(this.each(function(){var l=t.data(this,"plugin_"+s);l instanceof a&&"function"==typeof l.api[e]&&(i=l.api[e].apply(l,Array.prototype.slice.call(n,1))),"destroy"===e&&t.data(this,"plugin_"+s,null)}),void 0!==i?i:this):void 0}}(jQuery,window,document);