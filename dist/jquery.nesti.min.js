/*
 *  nesti - v0.0.1
 *  A straight forward plugin for adding some very helpful functionalities to nested/tree structure checkbox lists.
 *  http://jkaczmar.com
 *
 *  Made by Justin Kaczmar
 *  Under MIT License
 */

!function(t,i,e,n){"use strict";var s="nesti",l={filterable:!1,filter:{css:{position:"sticky",top:0,width:"100%",padding:"6px 10px",border:"none",boxSizing:"border-box"}},collapse:{enabled:!1,speed:250,collapseTemplate:'<i class="fas fa-minus text-smaller position-relative nesti-toggle nesti-toggle-collapse" style="font-size: .6rem;"></i>',expandTemplate:'<i class="fas fa-plus text-smaller position-relative nesti-toggle nesti-toggle-expand" style="font-size: .6rem;"></i>'},onChange:null};function a(i,e){this.element=i,this.settings=t.extend(!0,{},l,e),this._defaults=l,this._name=s,this._targetId=this.element.id,this._html=[],this.init(),this.api={"api.collect":function(){return Array.from(this.tree.find("input.leaf:checkbox:checked").map(function(){return this.dataset.value}))},"api.filter":function(t){this.filter(t)},"api.buildList":function(t,i=!1){this.buildList(t,i)}}}t.extend(a.prototype,{init:function(){this.settings.filterable&&this._makeFilter(),this.tree=t(this.element),this._dressElement(),this.initHandlers()},_dressElement:function(){this.tree.css("list-style","none"),this.tree.find("ul").css("list-style","none")},initHandlers:function(){var i=this;t(i.element).find("input:checkbox").on("change",function(){var e=t(this).closest("li");i._isRoot(e)?i._lookForward(e):i._isLeaf(e)?i._lookBackward(e):(i._lookForward(e),i._lookBackward(e)),"function"==typeof i.settings.onChange&&i.settings.onChange.call()}),i._initToggleHandlers()},_initToggleHandlers:function(){var i=this;t(i.element).find(".nesti-toggle-collapse").on("click",function(){var e=t(this).closest("li");i.collapse(e)}),t(i.element).find(".nesti-toggle-expand").on("click",function(){var e=t(this).closest("li");i.expand(e)})},_makeFilter:function(){var i=this;t('<input type="text" class="form-control form-control-sm" placeholder="Find a filter.." id="'+this._targetId+'-filter-input">').css(i.settings.filter.css).insertBefore(this.element),t("#"+this._targetId+"-filter-input").on("keyup",function(){i.filter(t(this).val())})},_lookForward:function(i){var e=!!i.find("input:checkbox").first().prop("indeterminate")||i.find("input:checkbox").first().prop("checked");i.find("li").each(function(i,n){t(n).find("input:checkbox").prop("checked",e)})},_lookBackward:function(i){var e=this;i.parents("li").each(function(i,n){if(e._allChildrenChecked(t(n))?(t(n).find("input:checkbox").first().prop("checked",!0),t(n).find("input:checkbox").first().prop("indeterminate",!1)):e._someChildrenChecked(t(n))?t(n).find("input:checkbox").first().prop("indeterminate",!0):(t(n).find("input:checkbox").first().prop("checked",!1),t(n).find("input:checkbox").first().prop("indeterminate",!1)),"list"===t(n).parent().attr("id"))return!1})},_allChildrenChecked:function(t){return t.find("li").find("input:checkbox:checked").length===t.find("li").find("input:checkbox").length},_someChildrenChecked:function(t){var i=t.find("li").find("input:checkbox:checked").length;return i>0&&i!==t.find("li").find("input:checkbox").length},_isLeaf:function(t){return t.find("li").length<1},_isRoot:function(t){return t.parent("#list").length},filter:function(i){var e=this.tree.find("li");t(e).each(function(){var e=t(this).find("label").text();""===i?(t(this).css("visibility","visible"),t(this).fadeIn()):e.search(new RegExp(i,"i"))<0?(t(this).css("visibility","hidden"),t(this).fadeOut()):(t(this).css("visibility","visible"),t(this).fadeIn())})},collapse:function(t){t.find("ul").first().slideUp(this.settings.collapse.speed),t.find(".fa-minus").first().replaceWith(this.settings.collapse.expandTemplate),this._initToggleHandlers()},expand:function(t){t.find("ul").first().slideDown(this.settings.collapse.speed),t.find(".fa-plus").first().replaceWith(this.settings.collapse.collapseTemplate),this._initToggleHandlers()},buildList:function(i,n=!1){this._makeTier(i,n);var s=t(this._html.join(""));s.first("ul").attr("id",this.element.id),e.getElementById(this.element.id).innerHTML=s.html(),this._dressElement(),this.initHandlers()},_makeTier:function(t,i){this._html.push("<ul>"),t.forEach((t,e)=>{this._html.push("<li>"),this._html.push(this._listItemTemplate(t,e,i)),t.items&&this._makeTier(t.items,i),this._html.push("</li>")}),this._html.push("</ul>")},_listItemTemplate(t,i,e){return'<div style="display: flex; align-items: center;">'+(t.items&&this.settings.collapse.enabled?this.settings.collapse.collapseTemplate:"")+'<input class="'+(t.items?"":"leaf")+'" id="'+this._slugify(t.label)+"-"+i+'" data-value="'+(e?t.label:t.value)+'" data-id="'+this._slugify(t.label)+"-"+i+'" type="checkbox" style="margin:4px;margin-left:8px;" /><label class="text-small" for="'+this._slugify(t.label)+"-"+i+'" style="margin-bottom:0;">'+t.label+"</label></div>"},_slugify:t=>t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}),t.fn[s]=function(i){var e,n=arguments;return void 0===i||"object"==typeof i?this.each(function(){t.data(this,"plugin_"+s)||t.data(this,"plugin_"+s,new a(this,i))}):"string"==typeof i&&"_"!==i[0]&&"init"!==i?(this.each(function(){var l=t.data(this,"plugin_"+s);l instanceof a&&"function"==typeof l.api[i]&&(e=l.api[i].apply(l,Array.prototype.slice.call(n,1))),"destroy"===i&&t.data(this,"plugin_"+s,null)}),void 0!==e?e:this):void 0}}(jQuery,window,document);